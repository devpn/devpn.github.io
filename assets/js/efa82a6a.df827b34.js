"use strict";(self.webpackChunklego_front_devpn=self.webpackChunklego_front_devpn||[]).push([[7865],{1607:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(89379),i=n(80045),l=n(96540),s=n(1938),o=n(74848),a=["fieldProps","proFieldProps"],c=function(e,t){var n=e.fieldProps,l=e.proFieldProps,c=(0,i.A)(e,a);return(0,o.jsx)(s.A,(0,r.A)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:l},c))};const d=l.forwardRef(c)},17051:(e,t,n)=>{n.d(t,{K:()=>A});var r=n(90675),i=n(10467),l=n(89379),s=n(80641),o=n(80045),a=n(63315),c=n(61906),d=n(86830),u=n(70182),f=n.n(u),h=n(12533),p=n(68210),x=n(96540),v=n(40961),m=n(43662),j=n(74848),g=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function A(e){var t,n,u=e.children,A=e.trigger,y=e.onVisibleChange,b=e.onOpenChange,w=e.modalProps,C=e.onFinish,k=e.submitTimeout,I=e.title,T=e.width,S=e.visible,P=e.open,F=(0,o.A)(e,g);(0,p.g9)(!F.footer||!(null!=w&&w.footer),"ModalForm \u662f\u4e00\u4e2a ProForm \u7684\u7279\u6b8a\u5e03\u5c40\uff0c\u5982\u679c\u60f3\u81ea\u5b9a\u4e49\u6309\u94ae\uff0c\u8bf7\u4f7f\u7528 submit.render \u81ea\u5b9a\u4e49\u3002");var R=(0,x.useContext)(c.Ay.ConfigContext),_=(0,x.useState)([]),M=(0,s.A)(_,2)[1],E=(0,x.useState)(!1),L=(0,s.A)(E,2),O=L[0],q=L[1],N=(0,h.A)(!!S,{value:P||S,onChange:b||y}),G=(0,s.A)(N,2),$=G[0],D=G[1],K=(0,x.useRef)(null),z=(0,x.useCallback)((function(e){null===K.current&&e&&M([]),K.current=e}),[]),H=(0,x.useRef)(),J=(0,x.useCallback)((function(){var e,t,n,r=null!==(e=null!==(t=F.form)&&void 0!==t?t:null===(n=F.formRef)||void 0===n?void 0:n.current)&&void 0!==e?e:H.current;r&&null!=w&&w.destroyOnClose&&r.resetFields()}),[null==w?void 0:w.destroyOnClose,F.form,F.formRef]);(0,x.useImperativeHandle)(F.formRef,(function(){return H.current}),[H.current]),(0,x.useEffect)((function(){$&&(P||S)&&(null==b||b(!0),null==y||y(!0))}),[S,P,$]);var B=(0,x.useMemo)((function(){return A?x.cloneElement(A,(0,l.A)((0,l.A)({key:"trigger"},A.props),{},{onClick:(e=(0,i.A)((0,r.A)().mark((function e(t){var n,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(!$),null===(n=A.props)||void 0===n||null===(i=n.onClick)||void 0===i||i.call(n,t);case 2:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})})):null;var e}),[D,A,$]),V=(0,x.useMemo)((function(){var e,t,n,r,i,l;return!1!==F.submitter&&f()({searchConfig:{submitText:null!==(e=null!==(t=null==w?void 0:w.okText)&&void 0!==t?t:null===(n=R.locale)||void 0===n||null===(n=n.Modal)||void 0===n?void 0:n.okText)&&void 0!==e?e:"\u786e\u8ba4",resetText:null!==(r=null!==(i=null==w?void 0:w.cancelText)&&void 0!==i?i:null===(l=R.locale)||void 0===l||null===(l=l.Modal)||void 0===l?void 0:l.cancelText)&&void 0!==r?r:"\u53d6\u6d88"},resetButtonProps:{preventDefault:!0,disabled:k?O:void 0,onClick:function(e){var t;D(!1),null==w||null===(t=w.onCancel)||void 0===t||t.call(w,e)}}},F.submitter)}),[null===(t=R.locale)||void 0===t||null===(t=t.Modal)||void 0===t?void 0:t.cancelText,null===(n=R.locale)||void 0===n||null===(n=n.Modal)||void 0===n?void 0:n.okText,w,F.submitter,D,O,k]),Q=(0,x.useCallback)((function(e,t){return(0,j.jsxs)(j.Fragment,{children:[e,K.current&&t?(0,j.jsx)(x.Fragment,{children:(0,v.createPortal)(t,K.current)},"submitter"):t]})}),[]),U=(0,x.useCallback)(function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,i,l;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null==C?void 0:C(t),k&&n instanceof Promise&&(q(!0),i=setTimeout((function(){return q(!1)}),k),n.finally((function(){clearTimeout(i),q(!1)}))),e.next=4,n;case 4:return(l=e.sent)&&D(!1),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[C,D,k]),W=(0,a.$)($);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(d.A,(0,l.A)((0,l.A)((0,l.A)({title:I,width:T||800},w),W),{},{onCancel:function(e){var t;k&&O||(D(!1),null==w||null===(t=w.onCancel)||void 0===t||t.call(w,e))},afterClose:function(){var e;J(),D(!1),null==w||null===(e=w.afterClose)||void 0===e||e.call(w)},footer:!1!==F.submitter?(0,j.jsx)("div",{ref:z,style:{display:"flex",justifyContent:"flex-end"}}):null,children:(0,j.jsx)(m.I,(0,l.A)((0,l.A)({formComponentType:"ModalForm",layout:"vertical"},F),{},{onInit:function(e,t){var n;F.formRef&&(F.formRef.current=t),null==F||null===(n=F.onInit)||void 0===n||n.call(F,e,t),H.current=t},formRef:H,submitter:V,onFinish:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),contentRender:Q,children:u}))})),B]})}},41740:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var r=n(44622),i=n(78954),l=n(79791),s=n(86529),o=n(75147),a=n(84423),c=n(24057),d=n(96540),u=n(209),f=n(51806),h=n(56289),p=n(26771),x=n(79700),v=n(55538),m=n(74848);const j=10;function g(){const{userInfo:e,inited:t,setOpen:n}=(0,x.Py)(),[r,g]=(0,d.useState)(!0),[A,y]=(0,d.useState)(!1),[b,w]=(0,d.useState)(!1),[C,k]=(0,d.useState)([]),{message:I}=(0,i.x)();return(0,d.useEffect)((()=>{var n;n=j,e?(0,l.hk)({num:n}).then((e=>{k(e),!e||e.length<n?w(!0):w(!1)})).catch((()=>{w(!0)})).finally((()=>{g(!1)})):!e&&t&&(g(!1),w(!0))}),[e,t]),t?(0,m.jsx)(v.A,{title:"\u53cd\u9988\u5217\u8868",loading:r,extra:(0,m.jsx)(h.A,{to:"/ticket/new",children:"\u65b0\u5efa\u53cd\u9988"}),children:(0,m.jsx)(s.A,{rowKey:"id",itemLayout:"vertical",loadMore:r||b?e?null:(0,m.jsx)("div",{style:{textAlign:"center"},children:(0,m.jsx)(o.Ay,{type:"primary",onClick:()=>{n(x.cA.Login)},children:"\u767b\u5f55\u67e5\u770b\u6570\u636e"})}):(0,m.jsx)("div",{style:{textAlign:"center",marginTop:16},children:(0,m.jsx)(o.Ay,{onClick:()=>{y(!0),(0,l.hk)({started:C[C.length-1].created,num:j}).then((e=>{e.length<j&&w(!0);const t=C.concat(e);k(t),window.dispatchEvent(new Event("resize"))})).catch((()=>{I.error("\u52a0\u8f7d\u4e0d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})).finally((()=>{y(!1)}))},style:{paddingLeft:48,paddingRight:48},children:A?(0,m.jsxs)("span",{children:[(0,m.jsx)(u.A,{})," \u52a0\u8f7d\u4e2d..."]}):"\u52a0\u8f7d\u66f4\u591a"})}),dataSource:e?C:[],renderItem:e=>(0,m.jsxs)(s.A.Item,{children:[(0,m.jsx)(s.A.Item.Meta,{avatar:(0,m.jsx)(a.A,{count:e.unread,children:(0,m.jsx)(c.A,{size:64,icon:(0,m.jsx)(f.A,{}),style:{marginTop:32},src:e.profile?(0,p.qA)(e.profile):null})}),title:(0,m.jsx)(h.A,{to:`/ticket?q=${e.id}`,children:e.title}),description:(0,m.jsxs)(m.Fragment,{children:["\u64cd\u4f5c\u7cfb\u7edf\uff1a",(0,m.jsx)("strong",{children:p.DO[e.os]}),(0,m.jsx)("br",{}),"\u8fde\u63a5\u534f\u8bae\uff1a",(0,m.jsx)("strong",{children:p.JS[e.proto]}),(0,m.jsx)("br",{}),(0,p.Ew)(e.updated||e.created)]})}),(0,m.jsx)("pre",{children:e.content+(e.content.length>99?"...":"")})]})})}):null}var A=n(53592),y=n(8757),b=n(4331),w=n(17051),C=n(1607),k=n(10662),I=n(4213),T=n(66634),S=n(86830),P=n(27143),F=n(66540),R=n(56347);function _(e){let{ticketId:t}=e;const n=(0,d.useRef)(p.IG.get(p.LN.fileIds,[])),{inited:r,userInfo:u,updateUserInfo:j,setSuccess:g}=(0,x.Py)(),[A,_]=(0,d.useState)(!1),[M,E]=(0,d.useState)(""),[L,O]=(0,d.useState)(!1),[q,N]=(0,d.useState)(void 0),[G,$]=(0,d.useState)(!1),D=e=>{$(!0),(0,l.IG)(e).then((e=>{N(e)})).finally((()=>{$(!1)}))},{message:K}=(0,i.x)(),[z,H]=(0,d.useState)([]),J=()=>{if(q)for(const e of q.list)if(e.me&&e.do_read)return void j()};(0,d.useEffect)((()=>{D(t),B()}),[]),(0,d.useEffect)((()=>{const e=setTimeout((()=>{if(q)for(const e of q.list)if(e.me&&!e.do_read&&!e.is_read)return e.do_read=!0,void(0,l.DR)(t).then(J)}),1e4);return()=>{clearTimeout(e)}}),[q]);const B=()=>{const e=b.I.conn().lasturl()||"";H(n.current.map((t=>{const[n,r,i]=t.split("|");return{uid:n,ids:t,status:"done",url:(0,p.we)(e,`/file/${i||r}`),preview:(0,p.we)(e,`/file/${r}`)}})))};return r&&!u?(0,m.jsx)(R.rd,{to:"/ticket"}):(0,m.jsxs)(v.A,{loading:G,title:q?.title,extra:(0,m.jsxs)("div",{className:"space",children:[(0,m.jsx)(h.A,{to:"/ticket",children:"\u8fd4\u56de\u5217\u8868"}),(0,m.jsx)(o.Ay,{loading:G,onClick:()=>O(!0),children:"\u56de\u590d"})]}),children:[(0,m.jsxs)(P.A,{children:[(0,m.jsx)("title",{children:(0,F.s)(q?.title?q.title:"")}),(0,m.jsx)("meta",{property:"robots",content:"noindex, follow"})]}),(0,m.jsx)(k.A,{items:[{key:"1",label:"\u64cd\u4f5c\u7cfb\u7edf",children:p.DO[q?.os||""]},{key:"2",label:"\u8fde\u63a5\u534f\u8bae",children:p.JS[q?.proto||""]},{key:"3",label:"\u521b\u5efa\u65f6\u95f4",children:(0,p.Ew)(q?.created)}]}),(0,m.jsx)(s.A,{rowKey:"id",itemLayout:"vertical",dataSource:q?.list,renderItem:e=>(0,m.jsxs)(s.A.Item,{children:[(0,m.jsx)(s.A.Item.Meta,{avatar:(0,m.jsx)(a.A,{dot:e.me&&!e.is_read,children:(0,m.jsx)(c.A,{size:48,icon:(0,m.jsx)(f.A,{}),src:e.profile?(0,p.qA)(e.profile):null})}),description:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("strong",{children:e.me?"\u5ba2\u670d":"\u6211"}),(0,m.jsx)("br",{}),(0,p.Ew)(e.created)]})}),(0,m.jsx)("pre",{children:e.content}),e.attach?(0,m.jsx)("div",{style:{marginTop:20},children:(0,m.jsx)(I.A.PreviewGroup,{children:e.attach.map((e=>(0,m.jsx)(I.A,{style:{objectFit:"cover",padding:5},width:64,height:64,src:(0,p.qA)(e),preview:{src:(0,p.qA)(e,!0)}},e)))})}):null]})}),(0,m.jsxs)(w.K,{open:L,title:"\u56de\u590d\u53cd\u9988",width:640,onFinish:async e=>{e.id=t,n.current.length>0&&(e.attach=n.current),e.origin=(0,p.Ec)();try{await(0,l.Gc)(e),g({duration:60,placement:"topRight",message:"\u63d0\u4ea4\u6210\u529f",description:"\u6211\u4eec\u5c06\u4f1a\u5c3d\u5feb\u56de\u590d\u60a8\uff0c\u8bf7\u5728\u7ad9\u5185\u67e5\u770b\u5ba2\u670d\u53cd\u9988\u5185\u5bb9\u3002"}),n.current.length=0,p.IG.remove(p.LN.fileIds),O(!1),J(),D(e.id)}catch(r){K.error("\u63d0\u4ea4\u4e0d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")}},modalProps:{onCancel:()=>O(!1),destroyOnClose:!0,maskClosable:!1},children:[(0,m.jsx)(C.A,{label:"\u53cd\u9988\u5185\u5bb9",name:"content",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53cd\u9988\u5185\u5bb9"},{max:1e4,message:"\u5185\u5bb9\u8fc7\u957f\uff0c\u8bf7\u7cbe\u7b80\u63cf\u8ff0\u5185\u5bb9"}],placeholder:"\u8bf7\u8f93\u5165\u53cd\u9988\u5185\u5bb9",fieldProps:{rows:10}}),(0,m.jsx)(T.A,{name:"attach",accept:"image/jpg,image/jpeg,image/png",listType:"picture-card",fileList:z,onRemove:e=>{const t=e.ids,r=n.current.indexOf(t);r>-1&&(n.current.splice(r,1),p.IG.set(p.LN.fileIds,n.current))},onPreview:async e=>{E(e.preview),_(!0)},onChange:e=>{let{fileList:t}=e;return H(t)},customRequest:async e=>{const t=b.I.conn().token();if(!t||!u)return K.warning("\u4f1a\u8bdd\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"),void B();const r=e.file,i=await b.I.conn().url();if(!i)return K.warning("\u627e\u4e0d\u5230\u670d\u52a1\u5668"),void B();const l=(0,p.we)(i,`/up/image/${r.name}`),s=new XMLHttpRequest;s.open("POST",l),s.setRequestHeader("token",t),s.onreadystatechange=()=>{if(4==s.readyState){if(200==s.status){const e=s.responseText;n.current.indexOf(e)>-1?K.warning("\u56fe\u7247\u5df2\u7ecf\u5b58\u5728\u5217\u8868\u4e2d"):(n.current.push(e),p.IG.set(p.LN.fileIds,n.current))}else K.error("\u4e0a\u4f20\u56fe\u7247\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");B()}},s.send(r)},children:z.length>=5?null:(0,m.jsxs)("div",{children:[(0,m.jsx)(y.A,{}),(0,m.jsx)("div",{style:{marginTop:8},children:"\u6dfb\u52a0\u56fe\u7247"})]})})]}),(0,m.jsx)(S.A,{open:A,footer:null,onCancel:()=>_(!1),children:(0,m.jsx)("img",{style:{width:"100%"},src:M})})]})}function M(){const[e]=(0,A.b)();return(0,m.jsx)(r.A,{title:"\u53cd\u9988\u95ee\u9898",children:(0,m.jsx)("main",{children:(0,m.jsx)("div",{className:"container contain-margin",children:e&&/^\d+$/.test(e)?(0,m.jsx)(_,{ticketId:parseInt(e)}):(0,m.jsx)(g,{})})})})}},53592:(e,t,n)=>{n.d(t,{b:()=>l});n(96540),n(40797);var r=n(30604);const i="q";function l(){return(0,r.l)(i)}},55538:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(20053);const i={card:"card_D5QJ",head:"head__dCx",body:"body_BFWu"};var l=n(14779),s=n(74848);function o(e){let{title:t,extra:n,headStyle:o,bodyStyle:a,style:c,loading:d,children:u,className:f}=e;return(0,s.jsxs)("div",{className:(0,r.A)(i.card,f),style:c,children:[t||n?(0,s.jsxs)("div",{className:(0,r.A)("space-bt",i.head),style:o,children:[(0,s.jsx)("h3",{children:t}),(0,s.jsx)("div",{children:n})]}):null,(0,s.jsx)("div",{className:i.body,style:a,children:d?(0,s.jsx)(l.A,{}):u})]})}}}]);