"use strict";(self.webpackChunklego_front_devpn=self.webpackChunklego_front_devpn||[]).push([[4590],{64317:(e,r,s)=>{s.d(r,{Z:()=>h});var t=s(1413),n=s(45987),o=s(22270),i=s(67294),a=s(66758),l=s(48490),d=s(85893),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,r){var s=e.fieldProps,c=e.children,p=e.params,m=e.proFieldProps,f=e.mode,h=e.valueEnum,g=e.request,v=e.showSearch,x=e.options,Z=(0,n.Z)(e,u),P=(0,i.useContext)(a.Z);return(0,d.jsx)(l.Z,(0,t.Z)((0,t.Z)({valueEnum:(0,o.h)(h),request:g,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,t.Z)({options:x,mode:f,showSearch:v,getPopupContainer:P.getPopupContainer},s),ref:r,proFieldProps:m},Z),{},{children:c}))},m=i.forwardRef((function(e,r){var s=e.fieldProps,u=e.children,p=e.params,m=e.proFieldProps,f=e.mode,h=e.valueEnum,g=e.request,v=e.options,x=(0,n.Z)(e,c),Z=(0,t.Z)({options:v,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},s),P=(0,i.useContext)(a.Z);return(0,d.jsx)(l.Z,(0,t.Z)((0,t.Z)({valueEnum:(0,o.h)(h),request:g,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,t.Z)({getPopupContainer:P.getPopupContainer},Z),ref:r,proFieldProps:m},x),{},{children:u}))})),f=i.forwardRef(p);f.SearchSelect=m,f.displayName="ProFormComponent";const h=f},90672:(e,r,s)=>{s.d(r,{Z:()=>u});var t=s(1413),n=s(45987),o=s(67294),i=s(48490),a=s(85893),l=["fieldProps","proFieldProps"],d=function(e,r){var s=e.fieldProps,o=e.proFieldProps,d=(0,n.Z)(e,l);return(0,a.jsx)(i.Z,(0,t.Z)({ref:r,valueType:"textarea",fieldProps:s,proFieldProps:o},d))};const u=o.forwardRef(d)},98354:(e,r,s)=>{s.d(r,{Z:()=>a});var t=s(86010);const n={card:"card_D5QJ",head:"head__dCx",body:"body_BFWu"};var o=s(34410),i=s(85893);function a(e){let{title:r,extra:s,headStyle:a,bodyStyle:l,style:d,loading:u,children:c,className:p}=e;return(0,i.jsxs)("div",{className:(0,t.Z)(n.card,p),style:d,children:[r||s?(0,i.jsxs)("div",{className:(0,t.Z)("space-bt",n.head),style:a,children:[(0,i.jsx)("h3",{children:r}),(0,i.jsx)("div",{children:s})]}):null,(0,i.jsx)("div",{className:n.body,style:l,children:u?(0,i.jsx)(o.Z,{}):c})]})}},78156:(e,r,s)=>{s.r(r),s.d(r,{default:()=>y});var t=s(62813),n=s(67294),o=s(24969),i=s(21032),a=s(26594),l=s(7442),d=s(24599),u=s(2058),c=s(85576),p=s(80052),m=s(5966),f=s(64317),h=s(90672),g=s(16550),v=s(39960),x=s(42590),Z=s(98354),P=s(85893);function j(){const e=(0,n.useRef)(a.tO.get(a.VD.fileIds,[])),r=(0,n.useRef)(void 0),{userInfo:s,inited:t,open:j,setOpen:y,setSuccess:w}=(0,x.Pc)(),[S,C]=(0,n.useState)(!1),[b,q]=(0,n.useState)(""),[F,L]=(0,n.useState)([]),[E,R]=(0,n.useState)(!1),{message:k}=(0,l.S)(),O=(0,g.k6)(),I=()=>{const r=i.A.conn().lasturl()||"";L(e.current.map((e=>{const[s,t,n]=e.split("|");return{uid:s,ids:e,status:"done",url:(0,a.pv)(r,`/file/${n||t}`),preview:(0,a.pv)(r,`/file/${t}`)}})))},N=async t=>{const n=i.A.conn().token();if(!n||!s)return r.current=t,void y(x.Lo.Login);const o=await i.A.conn().url();if(!o)return k.warning("\u627e\u4e0d\u5230\u670d\u52a1\u5668"),void I();r.current=void 0;const l=t.file,d=`${o}/up/image/${l.name}`,u=new XMLHttpRequest;u.open("POST",d),u.setRequestHeader("token",n),u.onreadystatechange=()=>{if(4==u.readyState){if(200==u.status){const r=u.responseText;e.current.indexOf(r)>-1?k.warning("\u56fe\u7247\u5df2\u7ecf\u5b58\u5728\u5217\u8868\u4e2d"):(e.current.push(r),a.tO.set(a.VD.fileIds,e.current))}else k.error("\u4e0a\u4f20\u56fe\u7247\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");I()}},u.send(l)};(0,n.useEffect)((()=>{s&&t&&I()}),[t]),(0,n.useEffect)((()=>{s&&r.current?N(r.current):r.current&&!s&&j==x.Lo.None&&t?(r.current=void 0,I()):!t||s||r.current||j!=x.Lo.None||(e.current.length=0,a.tO.remove(a.VD.fileIds),I())}),[s,j]);return(0,P.jsxs)(Z.Z,{title:"\u65b0\u5efa\u53cd\u9988\u95ee\u9898",extra:(0,P.jsx)(v.Z,{to:"/ticket",children:"\u8fd4\u56de\u5217\u8868"}),loading:!t,children:[(0,P.jsxs)(p.A,{loading:E,style:{margin:"auto",marginTop:8,maxWidth:600},layout:"vertical",onFinish:async r=>{if(s){R(!0),e.current.length>0&&(r.attach=e.current),r.origin=(0,a.Wd)();try{await(0,d.s6)(r),e.current.length=0,a.tO.remove(a.VD.fileIds),w({duration:60,placement:"topRight",message:"\u63d0\u4ea4\u6210\u529f",description:"\u6211\u4eec\u5c06\u4f1a\u5c3d\u5feb\u56de\u590d\u60a8\uff0c\u8bf7\u5728\u7ad9\u5185\u67e5\u770b\u5ba2\u670d\u53cd\u9988\u5185\u5bb9\u3002"}),O.push("/ticket")}catch(t){k.error("\u63d0\u4ea4\u4e0d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")}finally{R(!1)}}else y(x.Lo.Login)},children:[(0,P.jsx)(m.Z,{label:"\u6807\u9898",name:"title",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53cd\u9988\u95ee\u9898\u6807\u9898"},{max:200,message:"\u53cd\u9988\u95ee\u9898\u6807\u9898\u8fc7\u957f\uff0c\u8bf7\u7cbe\u7b80\u95ee\u9898\u6807\u9898"}],placeholder:"\u9700\u8981\u53cd\u9988\u95ee\u9898\u7684\u6807\u9898"}),(0,P.jsx)(f.Z,{label:"\u64cd\u4f5c\u7cfb\u7edf",name:"os",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u64cd\u4f5c\u7cfb\u7edf"}],valueEnum:a.oU}),(0,P.jsx)(f.Z,{label:"\u8fde\u63a5\u534f\u8bae",name:"proto",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8fde\u63a5\u534f\u8bae"}],valueEnum:a.P6}),(0,P.jsx)(h.Z,{label:"\u53cd\u9988\u5185\u5bb9",name:"content",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53cd\u9988\u5185\u5bb9"},{max:1e4,message:"\u5185\u5bb9\u8fc7\u957f\uff0c\u8bf7\u7cbe\u7b80\u63cf\u8ff0\u5185\u5bb9"}],placeholder:"\u8bf7\u8be6\u7ec6\u63cf\u8ff0\u53cd\u9988\u5185\u5bb9\uff0c\u6700\u597d\u80fd\u914d\u4e0a\u76f8\u5173\u7684\u622a\u56fe",fieldProps:{rows:10}}),(0,P.jsx)(u.Z,{name:"attach",accept:"image/jpg,image/jpeg,image/png",listType:"picture-card",fileList:F,onRemove:r=>{const s=r.ids,t=e.current.indexOf(s);t>-1&&(e.current.splice(t,1),a.tO.set(a.VD.fileIds,e.current))},onPreview:async e=>{q(e.preview),C(!0)},onChange:e=>{let{fileList:r}=e;return L(r)},customRequest:N,children:F.length>=5?null:(0,P.jsxs)("div",{children:[(0,P.jsx)(o.Z,{}),(0,P.jsx)("div",{style:{marginTop:8},children:"\u6dfb\u52a0\u56fe\u7247"})]})})]}),(0,P.jsx)(c.Z,{open:S,footer:null,onCancel:()=>C(!1),children:(0,P.jsx)("img",{style:{width:"100%"},src:b})})]})}function y(){return(0,P.jsx)(t.Z,{title:"\u65b0\u5efa\u53cd\u9988\u95ee\u9898",children:(0,P.jsx)("main",{children:(0,P.jsx)("div",{className:"container contain-margin",children:(0,P.jsx)(j,{})})})})}}}]);