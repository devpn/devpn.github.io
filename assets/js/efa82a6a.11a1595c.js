"use strict";(self.webpackChunklego_front_devpn=self.webpackChunklego_front_devpn||[]).push([[7865],{1607:(e,n,t)=>{t.d(n,{A:()=>d});var r=t(89379),i=t(80045),l=t(96540),s=t(1938),o=t(74848),a=["fieldProps","proFieldProps"],c=function(e,n){var t=e.fieldProps,l=e.proFieldProps,c=(0,i.A)(e,a);return(0,o.jsx)(s.A,(0,r.A)({ref:n,valueType:"textarea",fieldProps:t,proFieldProps:l},c))};const d=l.forwardRef(c)},17051:(e,n,t)=>{t.d(n,{K:()=>A});var r=t(90675),i=t(10467),l=t(89379),s=t(80641),o=t(80045),a=t(63315),c=t(61906),d=t(86830),u=t(70182),f=t.n(u),h=t(12533),p=t(68210),x=t(96540),v=t(40961),m=t(43662),j=t(74848),g=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function A(e){var n,t,u=e.children,A=e.trigger,y=e.onVisibleChange,w=e.onOpenChange,b=e.modalProps,C=e.onFinish,k=e.submitTimeout,I=e.title,T=e.width,S=e.visible,P=e.open,F=(0,o.A)(e,g);(0,p.g9)(!F.footer||!(null!=b&&b.footer),"ModalForm \u662f\u4e00\u4e2a ProForm \u7684\u7279\u6b8a\u5e03\u5c40\uff0c\u5982\u679c\u60f3\u81ea\u5b9a\u4e49\u6309\u94ae\uff0c\u8bf7\u4f7f\u7528 submit.render \u81ea\u5b9a\u4e49\u3002");var R=(0,x.useContext)(c.Ay.ConfigContext),_=(0,x.useState)([]),M=(0,s.A)(_,2)[1],E=(0,x.useState)(!1),L=(0,s.A)(E,2),O=L[0],q=L[1],N=(0,h.A)(!!S,{value:P||S,onChange:w||y}),G=(0,s.A)(N,2),$=G[0],D=G[1],K=(0,x.useRef)(null),z=(0,x.useCallback)((function(e){null===K.current&&e&&M([]),K.current=e}),[]),H=(0,x.useRef)(),J=(0,x.useCallback)((function(){var e,n,t,r=null!==(e=null!==(n=F.form)&&void 0!==n?n:null===(t=F.formRef)||void 0===t?void 0:t.current)&&void 0!==e?e:H.current;r&&null!=b&&b.destroyOnClose&&r.resetFields()}),[null==b?void 0:b.destroyOnClose,F.form,F.formRef]);(0,x.useImperativeHandle)(F.formRef,(function(){return H.current}),[H.current]),(0,x.useEffect)((function(){$&&(P||S)&&(null==w||w(!0),null==y||y(!0))}),[S,P,$]);var B=(0,x.useMemo)((function(){return A?x.cloneElement(A,(0,l.A)((0,l.A)({key:"trigger"},A.props),{},{onClick:(e=(0,i.A)((0,r.A)().mark((function e(n){var t,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(!$),null===(t=A.props)||void 0===t||null===(i=t.onClick)||void 0===i||i.call(t,n);case 2:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})})):null;var e}),[D,A,$]),V=(0,x.useMemo)((function(){var e,n,t,r,i,l;return!1!==F.submitter&&f()({searchConfig:{submitText:null!==(e=null!==(n=null==b?void 0:b.okText)&&void 0!==n?n:null===(t=R.locale)||void 0===t||null===(t=t.Modal)||void 0===t?void 0:t.okText)&&void 0!==e?e:"\u786e\u8ba4",resetText:null!==(r=null!==(i=null==b?void 0:b.cancelText)&&void 0!==i?i:null===(l=R.locale)||void 0===l||null===(l=l.Modal)||void 0===l?void 0:l.cancelText)&&void 0!==r?r:"\u53d6\u6d88"},resetButtonProps:{preventDefault:!0,disabled:k?O:void 0,onClick:function(e){var n;D(!1),null==b||null===(n=b.onCancel)||void 0===n||n.call(b,e)}}},F.submitter)}),[null===(n=R.locale)||void 0===n||null===(n=n.Modal)||void 0===n?void 0:n.cancelText,null===(t=R.locale)||void 0===t||null===(t=t.Modal)||void 0===t?void 0:t.okText,b,F.submitter,D,O,k]),Q=(0,x.useCallback)((function(e,n){return(0,j.jsxs)(j.Fragment,{children:[e,K.current&&n?(0,j.jsx)(x.Fragment,{children:(0,v.createPortal)(n,K.current)},"submitter"):n]})}),[]),U=(0,x.useCallback)(function(){var e=(0,i.A)((0,r.A)().mark((function e(n){var t,i,l;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null==C?void 0:C(n),k&&t instanceof Promise&&(q(!0),i=setTimeout((function(){return q(!1)}),k),t.finally((function(){clearTimeout(i),q(!1)}))),e.next=4,t;case 4:return(l=e.sent)&&D(!1),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[C,D,k]),W=(0,a.$)($);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(d.A,(0,l.A)((0,l.A)((0,l.A)({title:I,width:T||800},b),W),{},{onCancel:function(e){var n;k&&O||(D(!1),null==b||null===(n=b.onCancel)||void 0===n||n.call(b,e))},afterClose:function(){var e;J(),D(!1),null==b||null===(e=b.afterClose)||void 0===e||e.call(b)},footer:!1!==F.submitter?(0,j.jsx)("div",{ref:z,style:{display:"flex",justifyContent:"flex-end"}}):null,children:(0,j.jsx)(m.I,(0,l.A)((0,l.A)({formComponentType:"ModalForm",layout:"vertical"},F),{},{onInit:function(e,n){var t;F.formRef&&(F.formRef.current=n),null==F||null===(t=F.onInit)||void 0===t||t.call(F,e,n),H.current=n},formRef:H,submitter:V,onFinish:function(){var e=(0,i.A)((0,r.A)().mark((function e(n){var t;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),contentRender:Q,children:u}))})),B]})}},41740:(e,n,t)=>{t.r(n),t.d(n,{default:()=>_});var r=t(44622),i=t(78954),l=t(79791),s=t(86529),o=t(75147),a=t(84423),c=t(24057),d=t(96540),u=t(209),f=t(51806),h=t(56289),p=t(26771),x=t(79700),v=t(55538),m=t(74848);const j=10;function g(){const{userInfo:e,inited:n,setOpen:t}=(0,x.Py)(),[r,g]=(0,d.useState)(!0),[A,y]=(0,d.useState)(!1),[w,b]=(0,d.useState)(!1),[C,k]=(0,d.useState)([]),{message:I}=(0,i.x)();return(0,d.useEffect)((()=>{var t;t=j,e?(0,l.hk)({num:t}).then((e=>{k(e),!e||e.length<t?b(!0):b(!1)})).catch((()=>{b(!0)})).finally((()=>{g(!1)})):!e&&n&&(g(!1),b(!0))}),[e,n]),n?(0,m.jsx)(v.A,{title:"\u53cd\u9988\u5217\u8868",loading:r,extra:(0,m.jsx)(h.A,{to:"/ticket/new",children:"\u65b0\u5efa\u53cd\u9988"}),children:(0,m.jsx)(s.A,{rowKey:"id",itemLayout:"vertical",loadMore:r||w?e?null:(0,m.jsx)("div",{style:{textAlign:"center"},children:(0,m.jsx)(o.Ay,{type:"primary",onClick:()=>{t(x.cA.Login)},children:"\u767b\u5f55\u67e5\u770b\u6570\u636e"})}):(0,m.jsx)("div",{style:{textAlign:"center",marginTop:16},children:(0,m.jsx)(o.Ay,{onClick:()=>{y(!0),(0,l.hk)({started:C[C.length-1].created,num:j}).then((e=>{e.length<j&&b(!0);const n=C.concat(e);k(n),window.dispatchEvent(new Event("resize"))})).catch((()=>{I.error("\u52a0\u8f7d\u4e0d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})).finally((()=>{y(!1)}))},style:{paddingLeft:48,paddingRight:48},children:A?(0,m.jsxs)("span",{children:[(0,m.jsx)(u.A,{})," \u52a0\u8f7d\u4e2d..."]}):"\u52a0\u8f7d\u66f4\u591a"})}),dataSource:e?C:[],renderItem:e=>(0,m.jsxs)(s.A.Item,{children:[(0,m.jsx)(s.A.Item.Meta,{avatar:(0,m.jsx)(a.A,{count:e.unread,children:(0,m.jsx)(c.A,{size:64,icon:(0,m.jsx)(f.A,{}),style:{marginTop:32},src:e.profile?(0,p.qA)(e.profile):null})}),title:(0,m.jsx)(h.A,{to:`/ticket?q=${e.id}`,children:e.title}),description:(0,m.jsxs)(m.Fragment,{children:["\u64cd\u4f5c\u7cfb\u7edf\uff1a",(0,m.jsx)("strong",{children:p.DO[e.os]}),(0,m.jsx)("br",{}),"\u8fde\u63a5\u534f\u8bae\uff1a",(0,m.jsx)("strong",{children:p.JS[e.proto]}),(0,m.jsx)("br",{}),(0,p.Ew)(e.updated||e.created)]})}),(0,m.jsx)("pre",{children:e.content+(e.content.length>99?"...":"")})]})})}):null}var A=t(8757),y=t(4331),w=t(17051),b=t(1607),C=t(10662),k=t(4213),I=t(66634),T=t(86830),S=t(27143),P=t(66540),F=t(56347);function R(e){let{ticketId:n}=e;const t=(0,d.useRef)(p.IG.get(p.LN.fileIds,[])),{inited:r,userInfo:u,updateUserInfo:j,setSuccess:g}=(0,x.Py)(),[R,_]=(0,d.useState)(!1),[M,E]=(0,d.useState)(""),[L,O]=(0,d.useState)(!1),[q,N]=(0,d.useState)(void 0),[G,$]=(0,d.useState)(!1),D=e=>{$(!0),(0,l.IG)(e).then((e=>{N(e)})).finally((()=>{$(!1)}))},{message:K}=(0,i.x)(),[z,H]=(0,d.useState)([]),J=()=>{if(q)for(const e of q.list)if(e.me&&e.do_read)return void j()};(0,d.useEffect)((()=>{D(n),B()}),[]),(0,d.useEffect)((()=>{const e=setTimeout((()=>{if(q)for(const e of q.list)if(e.me&&!e.do_read&&!e.is_read)return e.do_read=!0,void(0,l.DR)(n).then(J)}),1e4);return()=>{clearTimeout(e)}}),[q]);const B=()=>{const e=y.I.conn().lasturl()||"";H(t.current.map((n=>{const[t,r,i]=n.split("|");return{uid:t,ids:n,status:"done",url:(0,p.we)(e,`/file/${i||r}`),preview:(0,p.we)(e,`/file/${r}`)}})))};return r&&!u?(0,m.jsx)(F.rd,{to:"/ticket"}):(0,m.jsxs)(v.A,{loading:G,title:q?.title,extra:(0,m.jsxs)("div",{className:"space",children:[(0,m.jsx)(h.A,{to:"/ticket",children:"\u8fd4\u56de\u5217\u8868"}),(0,m.jsx)(o.Ay,{loading:G,onClick:()=>O(!0),children:"\u56de\u590d"})]}),children:[(0,m.jsxs)(S.A,{children:[(0,m.jsx)("title",{children:(0,P.s)(q?.title?q.title:"")}),(0,m.jsx)("meta",{name:"robots",content:"noindex,nofollow,noarchive"})]}),(0,m.jsx)(C.A,{items:[{key:"1",label:"\u64cd\u4f5c\u7cfb\u7edf",children:p.DO[q?.os||""]},{key:"2",label:"\u8fde\u63a5\u534f\u8bae",children:p.JS[q?.proto||""]},{key:"3",label:"\u521b\u5efa\u65f6\u95f4",children:(0,p.Ew)(q?.created)}]}),(0,m.jsx)(s.A,{rowKey:"id",itemLayout:"vertical",dataSource:q?.list,renderItem:e=>(0,m.jsxs)(s.A.Item,{children:[(0,m.jsx)(s.A.Item.Meta,{avatar:(0,m.jsx)(a.A,{dot:e.me&&!e.is_read,children:(0,m.jsx)(c.A,{size:48,icon:(0,m.jsx)(f.A,{}),src:e.profile?(0,p.qA)(e.profile):null})}),description:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("strong",{children:e.me?"\u5ba2\u670d":"\u6211"}),(0,m.jsx)("br",{}),(0,p.Ew)(e.created)]})}),(0,m.jsx)("pre",{children:e.content}),e.attach?(0,m.jsx)("div",{style:{marginTop:20},children:(0,m.jsx)(k.A.PreviewGroup,{children:e.attach.map((e=>(0,m.jsx)(k.A,{style:{objectFit:"cover",padding:5},width:64,height:64,src:(0,p.qA)(e),preview:{src:(0,p.qA)(e,!0)}},e)))})}):null]})}),(0,m.jsxs)(w.K,{open:L,title:"\u56de\u590d\u53cd\u9988",width:640,onFinish:async e=>{e.id=n,t.current.length>0&&(e.attach=t.current),e.origin=(0,p.Ec)();try{await(0,l.Gc)(e),g({duration:60,placement:"topRight",message:"\u63d0\u4ea4\u6210\u529f",description:"\u6211\u4eec\u5c06\u4f1a\u5c3d\u5feb\u56de\u590d\u60a8\uff0c\u8bf7\u5728\u7ad9\u5185\u67e5\u770b\u5ba2\u670d\u53cd\u9988\u5185\u5bb9\u3002"}),t.current.length=0,p.IG.remove(p.LN.fileIds),O(!1),J(),D(e.id)}catch(r){K.error("\u63d0\u4ea4\u4e0d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")}},modalProps:{onCancel:()=>O(!1),destroyOnClose:!0,maskClosable:!1},children:[(0,m.jsx)(b.A,{label:"\u53cd\u9988\u5185\u5bb9",name:"content",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53cd\u9988\u5185\u5bb9"},{max:1e4,message:"\u5185\u5bb9\u8fc7\u957f\uff0c\u8bf7\u7cbe\u7b80\u63cf\u8ff0\u5185\u5bb9"}],placeholder:"\u8bf7\u8f93\u5165\u53cd\u9988\u5185\u5bb9",fieldProps:{rows:10}}),(0,m.jsx)(I.A,{name:"attach",accept:"image/jpg,image/jpeg,image/png",listType:"picture-card",fileList:z,onRemove:e=>{const n=e.ids,r=t.current.indexOf(n);r>-1&&(t.current.splice(r,1),p.IG.set(p.LN.fileIds,t.current))},onPreview:async e=>{E(e.preview),_(!0)},onChange:e=>{let{fileList:n}=e;return H(n)},customRequest:async e=>{const n=y.I.conn().token();if(!n||!u)return K.warning("\u4f1a\u8bdd\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"),void B();const r=e.file,i=await y.I.conn().url();if(!i)return K.warning("\u627e\u4e0d\u5230\u670d\u52a1\u5668"),void B();const l=(0,p.we)(i,`/up/image/${r.name}`),s=new XMLHttpRequest;s.open("POST",l),s.setRequestHeader("token",n),s.onreadystatechange=()=>{if(4==s.readyState){if(200==s.status){const e=s.responseText;t.current.indexOf(e)>-1?K.warning("\u56fe\u7247\u5df2\u7ecf\u5b58\u5728\u5217\u8868\u4e2d"):(t.current.push(e),p.IG.set(p.LN.fileIds,t.current))}else K.error("\u4e0a\u4f20\u56fe\u7247\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");B()}},s.send(r)},children:z.length>=5?null:(0,m.jsxs)("div",{children:[(0,m.jsx)(A.A,{}),(0,m.jsx)("div",{style:{marginTop:8},children:"\u6dfb\u52a0\u56fe\u7247"})]})})]}),(0,m.jsx)(T.A,{open:R,footer:null,onCancel:()=>_(!1),children:(0,m.jsx)("img",{style:{width:"100%"},src:M})})]})}function _(){const e=(0,p.mA)("q");return(0,m.jsx)(r.A,{title:"\u53cd\u9988\u95ee\u9898",children:(0,m.jsx)("main",{children:(0,m.jsx)("div",{className:"container contain-margin",children:e&&/^\d+$/.test(e)?(0,m.jsx)(R,{ticketId:parseInt(e)}):(0,m.jsx)(g,{})})})})}},55538:(e,n,t)=>{t.d(n,{A:()=>o});var r=t(20053);const i={card:"card_D5QJ",head:"head__dCx",body:"body_BFWu"};var l=t(14779),s=t(74848);function o(e){let{title:n,extra:t,headStyle:o,bodyStyle:a,style:c,loading:d,children:u,className:f}=e;return(0,s.jsxs)("div",{className:(0,r.A)(i.card,f),style:c,children:[n||t?(0,s.jsxs)("div",{className:(0,r.A)("space-bt",i.head),style:o,children:[(0,s.jsx)("h3",{children:n}),(0,s.jsx)("div",{children:t})]}):null,(0,s.jsx)("div",{className:i.body,style:a,children:d?(0,s.jsx)(l.A,{}):u})]})}}}]);