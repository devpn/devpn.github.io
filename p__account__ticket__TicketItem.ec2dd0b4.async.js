(self.webpackChunkdevpn_web=self.webpackChunkdevpn_web||[]).push([[8449],{90672:function(k,O,e){"use strict";var K=e(28991),I=e(81253),x=e(85893),T=e(67294),y=e(1188),U=["fieldProps","proFieldProps"],F=function(M,c){var S=M.fieldProps,A=M.proFieldProps,b=(0,I.Z)(M,U);return(0,x.jsx)(y.Z,(0,K.Z)({ref:c,valueType:"textarea",fieldProps:S,proFieldProps:A},b))};O.Z=T.forwardRef(F)},59347:function(k,O,e){"use strict";e.r(O);var K=e(71194),I=e(48889),x=e(43185),T=e(35372),y=e(58024),U=e(91894),F=e(12968),B=e(20352),M=e(54421),c=e(38272),S=e(54029),A=e(79166),b=e(94233),q=e(51890),ge=e(57663),X=e(71577),je=e(20228),ee=e(11382),Ze=e(98858),m=e(4914),Re=e(34792),v=e(48086),$=e(11849),z=e(91220),P=e(39428),L=e(3182),D=e(94657),h=e(42122),i=e(64097),te=e(49101),se=e(89366),ne=e(64335),re=e(70844),p=e(67294),C=e(62305),_e=e(51615),ae=e(37476),le=e(90672),g=e(92900),ie=e(34416),t=e(85893),u=[],oe=function(){var de=(0,C.tT)("@@initialState"),ue=de.setInitialState,Ee=(0,p.useState)(!1),H=(0,D.Z)(Ee,2),ve=H[0],G=H[1],Pe=(0,p.useState)(""),Q=(0,D.Z)(Pe,2),ce=Q[0],me=Q[1],De=(0,p.useState)([]),V=(0,D.Z)(De,2),Y=V[0],J=V[1],fe=function(){return G(!1)},Oe=function(){var a=(0,L.Z)((0,P.Z)().mark(function s(n){return(0,P.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:me(n.preview),G(!0);case 2:case"end":return r.stop()}},s)}));return function(n){return a.apply(this,arguments)}}(),Me=(0,p.useState)(!1),N=(0,D.Z)(Me,2),he=N[0],j=N[1],Z=(0,_e.UO)(),R=(0,C.QT)(h.Xf,{defaultParams:parseInt(Z.id)}),_=R.data,pe=R.loading,Ce=R.run,W=function(){if(!!_){var s=(0,z.Z)(_.list),n;try{for(s.s();!(n=s.n()).done;){var l=n.value;if(l.me&&l.do_read){(0,h.gS)().then(function(r){ue(function(E){return(0,$.Z)((0,$.Z)({},E),{},{currentUser:r})})});return}}}catch(r){s.e(r)}finally{s.f()}}};_&&setTimeout(function(){if(!!_){var a=(0,z.Z)(_.list),s;try{for(a.s();!(s=a.n()).done;){var n=s.value;if(n.me&&!n.do_read&&!n.is_read){n.do_read=!0,(0,h.jL)(parseInt(Z.id)).then(W);return}}}catch(l){a.e(l)}finally{a.f()}}},1e3);var Ie=(0,t.jsxs)("div",{children:[(0,t.jsx)(te.Z,{}),(0,t.jsx)("div",{style:{marginTop:8},children:"\u6DFB\u52A0\u56FE\u7247"})]}),Te=function(){var s=g.A.conn().lasturl()||"";J(u.map(function(n){var l=n.split("|"),r=(0,D.Z)(l,3),E=r[0],f=r[1],o=r[2];return{uid:E,ids:n,status:"done",url:(0,i.pv)(s,"/file/".concat(o||f)),preview:(0,i.pv)(s,"/file/".concat(f))}}))},Ue=function(s){var n=s.ids,l=u.indexOf(n);l>-1&&u.splice(l,1)},Be=function(){var a=(0,L.Z)((0,P.Z)().mark(function s(n){var l,r,E,f,o;return(0,P.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(l=g.A.conn().token(),l){d.next=4;break}return v.ZP.warn("\u4F1A\u8BDD\u8D85\u65F6\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55"),d.abrupt("return");case 4:return r=n.file,d.next=7,g.A.conn().url();case 7:if(E=d.sent,E){d.next=11;break}return v.ZP.warn("\u627E\u4E0D\u5230\u670D\u52A1\u5668"),d.abrupt("return");case 11:f=(0,i.pv)(E,"/up/image/".concat(r.name)),o=new XMLHttpRequest,o.open("POST",f),o.setRequestHeader("token",l),o.onreadystatechange=function(){if(o.readyState==4){if(o.status==200){var w=o.responseText;u.indexOf(w)>-1?v.ZP.warn("\u56FE\u7247\u5DF2\u7ECF\u5B58\u5728\u5217\u8868\u4E2D"):u.push(w)}else v.ZP.error("\u4E0A\u4F20\u56FE\u7247\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");Te()}},o.send(r);case 17:case"end":return d.stop()}},s)}));return function(n){return a.apply(this,arguments)}}(),Ae=function(){var a=(0,L.Z)((0,P.Z)().mark(function s(n){return(0,P.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.id=parseInt(Z.id),u.length>0&&(n.attach=u),n.origin=(0,i.Wd)(),r.prev=3,r.next=6,(0,h.ve)(n);case 6:v.ZP.success("\u63D0\u4EA4\u53CD\u9988\u6210\u529F\uFF0C\u6211\u4EEC\u5C06\u4F1A\u572824\u5C0F\u65F6\u5185\u56DE\u590D\u60A8",15),u.length=0,j(!1),W(),Ce(n.id),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(3),v.ZP.error("\u63D0\u4EA4\u53CD\u9988\u4E0D\u6210\u529F\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");case 16:case"end":return r.stop()}},s,null,[[3,13]])}));return function(n){return a.apply(this,arguments)}}(),Le=(0,t.jsx)(ne.Z.Consumer,{children:function(s){var n=s.isMobile;return(0,t.jsxs)(m.Z,{size:"small",column:n?1:2,children:[(0,t.jsx)(m.Z.Item,{label:"\u64CD\u4F5C\u7CFB\u7EDF",children:i.oU[(_==null?void 0:_.os)||""]}),(0,t.jsx)(m.Z.Item,{label:"\u8FDE\u63A5\u534F\u8BAE",children:i.P6[(_==null?void 0:_.proto)||""]}),(0,t.jsx)(m.Z.Item,{label:"\u521B\u5EFA\u65F6\u95F4",children:(0,i.uq)(_==null?void 0:_.created)}),(0,t.jsx)(m.Z.Item,{label:"\u66F4\u65B0\u65F6\u95F4",children:(0,i.uq)((_==null?void 0:_.updated)||(_==null?void 0:_.created))})]})}});return!_||pe?(0,t.jsx)(ee.Z,{size:"large"}):(0,t.jsxs)(re.ZP,{title:_.title,content:Le,breadcrumb:void 0,extra:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.Z,{onClick:function(){C.m8.push("/ticket/list"),W()},children:"\u8FD4\u56DE\u5217\u8868"}),(0,t.jsx)(X.Z,{type:"primary",onClick:function(){return j(!0)},children:"\u56DE\u590D"})]}),children:[(0,t.jsx)(C.ql,{children:(0,t.jsxs)("title",{children:[_.title," - ",ie.Z.show_name]})}),(0,t.jsx)(U.Z,{children:(0,t.jsx)(c.ZP,{rowKey:"id",itemLayout:"vertical",dataSource:_.list,renderItem:function(s){return(0,t.jsxs)(c.ZP.Item,{children:[(0,t.jsx)(c.ZP.Item.Meta,{avatar:(0,t.jsx)(A.Z,{dot:s.me&&!s.is_read,children:(0,t.jsx)(q.C,{size:32,style:{backgroundColor:"#CCC",marginTop:6},src:s.profile?(0,i.ZX)(s.profile):(0,t.jsx)(se.Z,{})})}),description:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{color:"#555"},children:s.me?"\u5BA2\u670D":"\u6211"}),(0,i.uq)(s.created)]})}),(0,t.jsx)("pre",{children:s.content}),s.attach?(0,t.jsx)("div",{style:{marginTop:20},children:(0,t.jsx)(B.Z.PreviewGroup,{children:s.attach.map(function(n){return(0,t.jsx)(B.Z,{style:{objectFit:"cover",padding:5},width:64,height:64,src:(0,i.ZX)(n),preview:{src:(0,i.ZX)(n,!0)}},n)})})}):null]})}})}),(0,t.jsxs)(ae.Y,{visible:he,title:"\u56DE\u590D\u53CD\u9988\u95EE\u9898",width:640,onFinish:Ae,modalProps:{onCancel:function(){return j(!1)},destroyOnClose:!0},children:[(0,t.jsx)(le.Z,{label:"\u53CD\u9988\u5185\u5BB9",name:"content",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53CD\u9988\u5185\u5BB9"},{max:1e4,message:"\u5185\u5BB9\u8FC7\u957F\uFF0C\u8BF7\u7CBE\u7B80\u63CF\u8FF0\u5185\u5BB9"}],placeholder:"\u8BF7\u8F93\u5165\u53CD\u9988\u5185\u5BB9",fieldProps:{rows:10}}),(0,t.jsx)(T.Z,{name:"attach",accept:"image/jpg,image/jpeg,image/png",listType:"picture-card",fileList:Y,onRemove:Ue,onPreview:Oe,onChange:function(s){var n=s.fileList;return J(n)},customRequest:Be,children:Y.length>=5?null:Ie})]}),(0,t.jsx)(I.Z,{visible:ve,footer:null,onCancel:fe,children:(0,t.jsx)("img",{style:{width:"100%"},src:ce})})]})};O.default=oe}}]);
